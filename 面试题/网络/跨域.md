## 为什么会出现跨域

因为浏览器有[同源策略](https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy)，即当前页面只可以请求相同**协议、域名、端口**都相同的情况下才可以请求。否则会出现跨域问题。

## 如何解决跨域问题

1. cors

[CORS](https://developer.mozilla.org/zh-CN/docs/Glossary/CORS)

2. JSONP
   在 HTML 标签里，一些标签比如 script、img 这样的获取资源的标签是没有跨域限制的，利用这一点，我们可以这样干

```js
/**
 * JSONP请求工具
 * @param url 请求的地址
 * @param data 请求的参数
 * @returns {Promise<any>}
 */
const request = ({ url, data }) => {
  return new Promise((resolve, reject) => {
    // 处理传参成xx=yy&aa=bb的形式
    const handleData = (data) => {
      const keys = Object.keys(data);
      const keysLen = keys.length;
      return keys.reduce((pre, cur, index) => {
        const value = data[cur];
        const flag = index !== keysLen - 1 ? "&" : "";
        return `${pre}${cur}=${value}${flag}`;
      }, "");
    };
    // 动态创建script标签
    const script = document.createElement("script");
    // 接口返回的数据获取
    window.jsonpCb = (res) => {
      document.body.removeChild(script);
      delete window.jsonpCb;
      resolve(res);
    };
    script.src = `${url}?${handleData(data)}&cb=jsonpCb`;
    document.body.appendChild(script);
  });
};
// 使用方式
request({
  url: "http://localhost:9871/api/jsonp",
  data: {
    // 传参
    msg: "helloJsonp",
  },
}).then((res) => {
  console.log(res);
});
```

3. nginx 代理

```nginx
server{
    # 监听9099端口
    listen 9099;
    # 域名是localhost
    server_name localhost;
    #凡是localhost:9099/api这个样子的，都转发到真正的服务端地址http://localhost:9871
    location ^~ /api {
        proxy_pass http://localhost:9871;
    }
}
```
